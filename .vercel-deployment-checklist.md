# Vercel Deployment Checklist

## Issue: "Product not found" error on Vercel deployment

### Root Cause
The production database connection is either:
1. Not configured (missing MONGODB_URI environment variable)
2. Pointing to an empty database
3. Using incorrect environment variable

### Solution Steps

#### 1. Add MONGODB_URI to Vercel Environment Variables

**Go to your Vercel project settings:**
1. Open your project on Vercel Dashboard
2. Go to **Settings** → **Environment Variables**
3. Add the following environment variable:
   - **Key**: `MONGODB_URI`
   - **Value**: `mongodb+srv://raneaniket23_db_user:dMVe5p1s19Zz7OGv@jewelrycatalog.8dlhxsu.mongodb.net/jewelry_catalog?retryWrites=true&w=majority&appName=jewelryCatalog`
   - **Environment**: Select all (Production, Preview, Development)
4. Click **Save**

#### 2. Redeploy Your Application

After adding the environment variable:
1. Go to **Deployments** tab
2. Click on the latest deployment
3. Click the **⋯** menu → **Redeploy**
4. Wait for deployment to complete

#### 3. Verify the Fix

After redeployment:
1. Visit your deployed site
2. Click on any product
3. The product details should now load correctly

### Why This Happens

- **Local**: Uses `.env` file with `MONGODB_URI`
- **Vercel**: Needs environment variables configured in Vercel Dashboard
- Without `MONGODB_URI`, the API can't connect to MongoDB and returns "Product not found"

### Code Fix Applied

Also fixed `api/_lib/storage.ts` to add proper ObjectId validation:

```typescript
export function stringToObjectId(id: string): ObjectId {
  if (!ObjectId.isValid(id)) {
    throw new Error(`Invalid ObjectId format: ${id}`);
  }
  return new ObjectId(id);
}
```

This ensures invalid IDs are caught early with clear error messages.
